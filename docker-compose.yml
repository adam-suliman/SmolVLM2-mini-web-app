services:
  app:
    build: .
    ports:
      - "${APP_PORT:-7860}:${APP_PORT:-7860}"
    environment:
      SMOLVLM2_MODEL_ID: "${SMOLVLM2_MODEL_ID:-HuggingFaceTB/SmolVLM2-2.2B-Instruct}"
      MODEL_DEVICE: "${MODEL_DEVICE:-auto}"
      APP_PORT: "${APP_PORT:-7860}"

      HF_HOME: "/data/hf_cache"

      HF_HUB_CACHE: "/data/hf_cache/hub"
      TRANSFORMERS_CACHE: "/data/hf_cache/hub"
      HF_DATASETS_CACHE: "/data/hf_cache/datasets"

      HF_HUB_OFFLINE: "${HF_HUB_OFFLINE:-0}"

    # Кэш/веса на хосте: Compose сам создаст ./data/hf_cache при первом запуске
    volumes:
      - type: bind
        source: ./data/hf_cache
        target: /data/hf_cache
        bind:
          create_host_path: true


    gpus: all

    restart: unless-stopped
